<div class="min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8">
  <div class="max-w-md w-full">
    <!-- Banner informativo si viene de guest order -->
    @if (prefilledData(); as data) {
      <div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
        <div class="flex items-start">
          <i class="pi pi-info-circle text-blue-500 mt-0.5 mr-3"></i>
          <div>
            <h3 class="font-semibold text-blue-900 mb-1">
              Crie sua conta para acessar seu pedido
            </h3>
            <p class="text-sm text-blue-700">
              Pedido <span class="font-mono font-semibold">{{ data.orderNumber }}</span> pronto para ser vinculado ao seu perfil
            </p>
          </div>
        </div>
      </div>
    }

    <!-- Card de registro -->
    <p-card>
      <ng-template pTemplate="header">
        <div class="pt-6 px-6">
          <h2 class="text-2xl font-bold text-gray-900">Criar Conta</h2>
          <p class="mt-2 text-sm text-gray-600">
            Preencha seus dados para se registrar
          </p>
        </div>
      </ng-template>

      <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="space-y-6">
        <!-- Email (pré-preenchido se vem de pedido guest) -->
        <div>
          <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
            E-mail
          </label>
          <input
            pInputText
            id="email"
            formControlName="email"
            type="email"
            placeholder="tu@email.com"
            class="w-full"
            [class.disabled:opacity-60]="registerForm.get('email')?.disabled"
          />
          @if (registerForm.get('email')?.invalid && registerForm.get('email')?.touched) {
            <small class="text-red-500 mt-1 block">
              {{ getErrorMessage('email') }}
            </small>
          }
        </div>

        <!-- Nome (pré-preenchido) -->
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label for="firstName" class="block text-sm font-medium text-gray-700 mb-2">
              Nome
            </label>
            <input
              pInputText
              id="firstName"
              formControlName="firstName"
              placeholder="João"
              class="w-full"
              [class.disabled:opacity-60]="registerForm.get('firstName')?.disabled"
            />
            @if (registerForm.get('firstName')?.invalid && registerForm.get('firstName')?.touched) {
              <small class="text-red-500 mt-1 block">
                {{ getErrorMessage('firstName') }}
              </small>
            }
          </div>

          <div>
            <label for="lastName" class="block text-sm font-medium text-gray-700 mb-2">
              Sobrenome
            </label>
            <input
              pInputText
              id="lastName"
              formControlName="lastName"
              placeholder="Silva"
              class="w-full"
              [class.disabled:opacity-60]="registerForm.get('lastName')?.disabled"
            />
            @if (registerForm.get('lastName')?.invalid && registerForm.get('lastName')?.touched) {
              <small class="text-red-500 mt-1 block">
                {{ getErrorMessage('lastName') }}
              </small>
            }
          </div>
        </div>

        <!-- Telefone (pré-preenchido, opcional) -->
        <div>
          <label for="phone" class="block text-sm font-medium text-gray-700 mb-2">
            Telefone <span class="text-gray-400">(opcional)</span>
          </label>
          <input
            pInputText
            id="phone"
            formControlName="phone"
            placeholder="+55 11 98765-4321"
            class="w-full"
            [class.disabled:opacity-60]="registerForm.get('phone')?.disabled"
          />
        </div>

        <!-- Senha -->
        <div>
          <label for="password" class="block text-sm font-medium text-gray-700 mb-2">
            Senha
          </label>
          <p-password
            formControlName="password"
            placeholder="Mínimo 6 caracteres"
            [toggleMask]="true"
            [feedback]="true"
            styleClass="w-full"
            inputStyleClass="w-full"
          />
          @if (registerForm.get('password')?.invalid && registerForm.get('password')?.touched) {
            <small class="text-red-500 mt-1 block">
              {{ getErrorMessage('password') }}
            </small>
          }
        </div>

        <!-- Confirmar Senha -->
        <div>
          <label for="confirmPassword" class="block text-sm font-medium text-gray-700 mb-2">
            Confirmar Senha
          </label>
          <p-password
            formControlName="confirmPassword"
            placeholder="Repita sua senha"
            [toggleMask]="true"
            [feedback]="false"
            styleClass="w-full"
            inputStyleClass="w-full"
          />
          @if (registerForm.get('confirmPassword')?.touched && !passwordsMatch()) {
            <small class="text-red-500 mt-1 block">
              As senhas não coincidem
            </small>
          }
        </div>

        <!-- Termos e condições -->
        <div class="flex items-start">
          <p-checkbox
            formControlName="acceptTerms"
            [binary]="true"
            inputId="acceptTerms"
            class="mr-2"
          />
          <label for="acceptTerms" class="text-sm text-gray-700 cursor-pointer">
            Aceito os <a href="#" class="text-blue-600 hover:underline">termos e condições</a>
            e a <a href="#" class="text-blue-600 hover:underline">política de privacidade</a>
          </label>
        </div>
        @if (registerForm.get('acceptTerms')?.invalid && registerForm.get('acceptTerms')?.touched) {
          <small class="text-red-500 mt-1 block">
            Você deve aceitar os termos e condições
          </small>
        }

        <!-- Botão Submit -->
        <p-button
          type="submit"
          label="Criar Conta"
          icon="pi pi-user-plus"
          styleClass="w-full"
          [loading]="loading()"
          [disabled]="registerForm.invalid || !passwordsMatch() || loading()"
        />
      </form>

      <ng-template pTemplate="footer">
        <div class="flex justify-center pb-4">
          <p-button
            label="Voltar"
            icon="pi pi-arrow-left"
            severity="secondary"
            [outlined]="true"
            (onClick)="goBack()"
          />
        </div>
      </ng-template>
    </p-card>
  </div>
</div>
